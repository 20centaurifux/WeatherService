var Dashboard=function(n){var t=n||{},f=this,i=function(){if(t.updateUrl){var n=[];$(".gridster li").each(function(){var t=$(this);n.push({widgetId:t.attr("data-widget-guid"),x:t.attr("data-col"),y:t.attr("data-row"),filter:t.attr("data-widget-stations").split(",")})});$.ajax({url:t.updateUrl,type:"POST",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).fail(function(n){console.warn(n.responseText)})}},u=$(".gridster ul").gridster({widget_base_dimensions:[120,120],widget_margins:[10,10],draggable:{stop:function(){t.updateUrl&&setTimeout(i,0)}}}).data("gridster"),r;this.refresh=function(){var n=parseInt((new Date).getTime()/1e3,10);$(".gridster li").each(function(){var t=$(this),i=parseInt(t.attr("data-widget-last-sync"),10),r;(!i||n-i>=180)&&(t.attr("data-widget-last-sync",n),r=t.attr("data-widget-url")+"?s="+t.attr("data-widget-stations")+"&t="+(new Date).getTime(),$.get(r).done(function(n){t.html(n)}))})};r=function(n,t){return'<li style="background-color:'+n.background+';" data-widget-stations="'+t.join(",")+'" data-widget-guid="'+n.guid+'" data-widget-url="'+n.url+'" data-widget-last-sync="0"><\/li>'};this.addWidget=function(n,t){u.add_widget(r(n,t),n.width,n.height);this.refresh();i()};setInterval(this.refresh,15e3)};