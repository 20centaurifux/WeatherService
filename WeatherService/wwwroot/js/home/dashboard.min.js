var Dashboard=function(n){var t=n||{},f=this,i=function(){if(t.updateUrl){var n=[];$(".gridster li").each(function(){var t=$(this);n.push({widgetId:t.attr("data-widget-guid"),x:t.attr("data-col"),y:t.attr("data-row"),filter:t.attr("data-widget-stations").split(",")})});$.ajax({url:t.updateUrl,type:"POST",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).fail(function(n){console.warn(n.responseText)})}},r=$(".gridster ul").gridster({widget_base_dimensions:[120,120],widget_margins:[10,10],draggable:{stop:function(){t.updateUrl&&setTimeout(i,0)}}}).data("gridster"),u;this.refresh=function(){var n=parseInt((new Date).getTime()/1e3,10);$(".gridster li").each(function(){var t=$(this),u=parseInt(t.attr("data-widget-last-sync"),10);(!u||n-u>=120)&&(t.html('<img src="/assets/rings.svg" style="position:absolute; margin:auto; top:0; left:0; right:0; bottom:0;">'),setTimeout(()=>{t.attr("data-widget-last-sync",n);var u=t.attr("data-widget-url")+"?s="+t.attr("data-widget-stations")+"&t="+(new Date).getTime();$.get(u).done(function(n){t.html("");var u=$(n+'<div class="dashboard-action"><h1 class="dashboard-action">Edit<\/h1><a class="dashboard-action" style="float:right;"><i class="fa fa-times-circle dashboard-action" aria-hidden="true"><\/i><\/a><a class="dashboard-action" style="float:right; padding-right:5px;"><i class="fa fa-edit dashboard-action" aria-hidden="true"><\/i><\/a><span style="clear:right;"><\/span><\/div>').appendTo(t);t.unbind("mouseenter").unbind("mouseleave");t.bind("mouseenter",()=>{t.find("div.dashboard-action").show()});t.bind("mouseleave",()=>{t.find("div.dashboard-action").hide()});u.find("a:eq(0)").bind("click",()=>{r.remove_widget(t.get(0),i)})})},Math.floor(Math.random()*1800)+500))})};u=function(n,t){return'<li style="background-color:'+n.background+';" data-widget-stations="'+t.join(",")+'" data-widget-guid="'+n.guid+'" data-widget-url="'+n.url+'" data-widget-last-sync="0"><\/li>'};this.addWidget=function(n,t){r.add_widget(u(n,t),n.width,n.height);this.refresh();i()};setInterval(this.refresh,15e3)};