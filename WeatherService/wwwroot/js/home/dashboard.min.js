var Dashboard=function(n){var t=n||{},f=this,i=function(){if(t.onSave){var n=[];$(".gridster li").each(function(){var t=$(this);n.push({widgetId:t.attr("data-widget-guid"),x:t.attr("data-col"),y:t.attr("data-row"),filter:t.attr("data-widget-stations").split(",")})});t.onSave(n)}},r=$(".gridster ul").gridster({widget_base_dimensions:[120,120],widget_margins:[10,10],draggable:{stop:function(){setTimeout(i,0)}}}).data("gridster"),u;this.refresh=function(){var n=parseInt((new Date).getTime()/1e3,10);$(".gridster li").each(function(){var u=$(this),f=parseInt(u.attr("data-widget-last-sync"),10);(!f||n-f>=120)&&(u.html('<img src="/assets/rings.svg" style="position:absolute; margin:auto; top:0; left:0; right:0; bottom:0;">'),setTimeout(()=>{u.attr("data-widget-last-sync",n);var f=u.attr("data-widget-url")+"?s="+u.attr("data-widget-stations")+"&t="+(new Date).getTime();$.get(f).done(function(n){u.html("");var f=$(n+'<div class="dashboard-action"><h1 class="dashboard-action">Edit<\/h1><a class="dashboard-action" style="float:right;"><i class="fa fa-times-circle dashboard-action" aria-hidden="true"><\/i><\/a><a class="dashboard-action" style="float:right; padding-right:5px;"><i class="fa fa-edit dashboard-action" aria-hidden="true"><\/i><\/a><span style="clear:right;"><\/span><\/div>').appendTo(u);u.unbind("mouseenter").unbind("mouseleave");u.bind("mouseenter",()=>{u.find("div.dashboard-action").show()});u.bind("mouseleave",()=>{u.find("div.dashboard-action").hide()});f.find("a:eq(0)").bind("click",()=>{r.remove_widget(u.get(0),i)});t.onEdit&&f.find("a:eq(1)").bind("click",()=>{t.onEdit(u.get(0),u.attr("data-widget-guid"),u.attr("data-widget-stations").split(","))})})},Math.floor(Math.random()*1800)+500))})};u=function(n,t){return'<li style="background-color:'+n.background+';" data-widget-stations="'+t.join(",")+'" data-widget-guid="'+n.guid+'" data-widget-url="'+n.url+'" data-widget-last-sync="0"><\/li>'};this.addWidget=function(n,t){r.add_widget(u(n,t),n.width,n.height);this.refresh();i()};this.updateWidget=function(n,t){$(n).attr("data-widget-stations",t.join(",")).attr("data-widget-last-sync","0");this.refresh();i()};setInterval(this.refresh,15e3)};